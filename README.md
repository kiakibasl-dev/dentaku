# 多機能電卓アプリ（CUI）
コマンドラインで動く電卓アプリです。


## 1.概要
Windowsのデフォルトの電卓アプリを再現しました。
この電卓には複数の機能があり、その中から通常の電卓、進数変換、為替レート算出の3つを選びました。

### 選出の理由
業務としてプログラマ未経験であるため、初級者向けである電卓作成にいくつか機能を加えたものを最初の制作物に選びました。

進数変換を選んだ理由は、多少複雑なアルゴリズムの実装が必要なこと、2進数や16進数への理解を示すことです。

為替レート機能の理由は、外部APIを用いた通信プログラムであるからです。標準入力以外の入力にも理解があります。

![デフォルトの電卓アプリ](https://github.com/user-attachments/assets/25249077-7972-4d39-acd0-502f8d5c7725)

## 2.開発背景
### 学生時代にC++を独学
数学・情報数理学科の必修授業で[Pascal](https://ja.wikipedia.org/wiki/Pascal)を学びました。Pascalは教育・学術用で、学習当時から開発環境では基本使われないマイナーな言語です。プログラミングに初めて触れたのはこの時でした

授業ではPascalのほかに関数型言語のarc,scheme([Lisp方言](https://ja.wikipedia.org/wiki/LISP))を学びましたが、オブジェクト指向言語の学習や自分のスキルアップ、メジャー言語の開発経験のことを考えC++を独学しました。独学の際には競技プログラミングの資料を参考にしていたので、全探索や計算量に関するアルゴリズムを中心に学びました。

### GUI経験なし
自分のPCスペックの都合上IDEや大型ライブラリの導入が困難で、GUIの開発経験はありません。また授業や競技プログラミングではアルゴリズムの学習が中心でした。

## 3.機能
### 機能一覧
|項目|内容|開発期間|
|:---|:---:|:---:|
|標準の電卓|四則演算|7時間|
|進数変換|10進数を16までの進数に変換|7時間|
|為替レート|為替レートを取得し計算|20時間|

### 標準の電卓
do-while文で入出力や演算をループさせることで、電卓の特徴である加減乗除を繰り返す処理を再現しました。見直すとシンプルにwhile文でよかったですね。

オペランドや演算子の入力でもdo-whileループを用いてエラーハンドリングを行っています。
型は合っているが入力を間違えた場合に対応していないのが不親切かもしれません。

![demo](https://github.com/user-attachments/assets/5dbea1ec-52d6-4631-aa20-a80d7cba6de6)

![標準電卓.drawio](https://github.com/user-attachments/assets/0669d8a7-c9e1-4102-abee-1cafb5ca1388)


### 進数変換
10進数を任意（2～16）の進数に変換します。
11以上の進数に対応するために変換された数は文字列で扱われます。逆変換を実装するときは工夫しないといけません。

アルゴリズムは単純で、剰余と商を交互に行って下の桁から計算しています。stringのreverseを用いて逆順になっている進数表示を直しています。

![base_n_num.drawio](https://github.com/user-attachments/assets/b32c5259-b56f-47c8-9056-35a8c3a0f26b)

### 為替レート
http通信で為替レートをjson形式で取得します。jsonには各通貨に対してアメリカドルとのレートやそのレートの逆数などが結びついています。

![為替APIのjsonの一部](https://github.com/user-attachments/assets/5321ac4f-7e23-4805-96f7-76a5f9e04812)
https://jsoneditoronline.org/#left=local.vesofi&right=local.huxani

変換前の通貨（基準通貨）とアメリカドルのレートの逆数と、変換後の通貨（決済通貨）とアメリカドルのレートを掛け算すれば任意の組み合わせで為替レートを算出できます。

通貨コードは大体の人が知らないので通貨コードの一覧を出力するようにしました。コードに併せて国名もつければなお親切だったかもしれません。

![通貨コードの一覧](https://github.com/user-attachments/assets/0e0659b5-ad72-4af1-8f7c-9f9cbe8a1677)

通貨コードの入出力はあまり凝っていません。最後に編集したのが電卓だったためです。入力した文字列がヒットしない場合はプログラムを終了します。

基準通貨、決済通貨、基準通貨の金額を入力すると決済通貨の金額が出力されます。

![rateAPI.drawio](https://github.com/user-attachments/assets/c58c67cb-7680-4957-97c4-6cfd437472aa)

## 4.開発環境
| 項目 | 内容 |
|:---|:---|
|言語|C++17|
|エディタ|Visual Studio Code|
|コンパイラ|Mingw_w64(GCC 15.2.0)|
|ライブラリ|nlohmann/json, cpp-httplib|
|外部API|http://www.floatrates.com|

## 5.工夫した点
### バリデーション
通常の電卓と違ってキーボードで入力が行われます。そのため入力値の型を間違えた時の処理をwhile文を用いて実装しました。

```cpp
//左オペランドの入力
    do{
        cout << "左オペランド(数値)を入力してください" << endl;
        cin >> num1;
        //エラー処理
        if(cin.fail()){
            cout << "入力が数値ではありません。" << endl;
            cin.clear(); cin.ignore();
        }else break;
    }while(1);
```

### 親切なUI
グラフィックがないので、とにかく言葉を尽くしました。大学の課題や競技プログラミングではUIに凝ることがありませんでした。一つ一つの入出力に説明を出力させて、CUI特有の分かりづらさを緩和できたと思います。

## 6.今後の課題
### まだ穴の多いバリデーション
入力をループ処理することで入力ミスを回避しましたが、電卓アプリでは

```
演算子を入力してください（終了するには'q'）
+20
```

のように入力すると右オペランドを入力する前に演算の処理が終了します。原因はcinでcharを読み込む部分で複数の文字（文字列）を入力するとcinのバッファに2文字目以降のデータが残ってしまうことです。
### ファイルの分割
今回は別々にファイルを作成しましたが、ゆくゆくは各ファイルをソースファイルとして一つのプログラムに纏めたいと思います。

