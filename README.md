# 多機能電卓アプリ（CUI）

コマンドラインで動く電卓アプリです。
## 1.概要
Windowsのデフォルトの電卓アプリを再現しました。
ファイルの入出力も行いました。

## 2.開発背景
### 学生時代にC++を独学
大学の必修授業でPascalを学びました。ここで初めてプログラミングに触れ、友人の紹介で競技プログラミング（主に[Atcoder](https://atcoder.jp/home)）に参加するようになりました。Pascalは競技プログラミングに向いておらずC++が推奨されていたため、C++の独学をしました。
### GUI経験なし
自分のPCスペックの都合上、GUI開発が困難でした。また授業や競技プログラミングはCLIがほとんどでした。

## 3.機能
### 機能一覧
|項目|内容|
|:---|:---:|
|標準の電卓|四則演算|
|進数変換|10進数を16までの進数に変換|
|為替レート|為替レートを取得し計算|
### 使い方
#### 標準の電卓
do-while文で入出力や演算をループさせることで、電卓の特徴である加減乗除を繰り返す処理を再現しました。見直すとシンプルにwhile文でよかったですね。

オペランドや演算子の入力でもdo-whileループを用いてエラーハンドリングを行っています。
型は合っているが入力を間違えた場合に対応していないのが不親切かもしれません。

![demo](https://github.com/user-attachments/assets/5dbea1ec-52d6-4631-aa20-a80d7cba6de6)
#### 進数変換
10進数を任意（2～16）の進数に変換します。
11以上の進数に対応するために変換された数は文字列で扱われます。逆変換を実装するときは工夫しないといけません。

アルゴリズムは単純で、剰余と商を交互に行って下の桁から計算しています。stringのreverseを用いて逆順になっている進数表示を直しています。
#### 為替レート
http通信で為替レートをjson形式で取得します。jsonには各通貨に対してアメリカドルとのレートやそのレートの逆数などが結びついています。

![為替APIのjsonの一部](https://github.com/user-attachments/assets/5321ac4f-7e23-4805-96f7-76a5f9e04812)

https://jsoneditoronline.org/#left=local.vesofi&right=local.huxani

変換前の通貨（基準通貨）とアメリカドルのレートの逆数と、変換後の通貨（決済通貨）とアメリカドルのレートを掛け算すれば任意の組み合わせで為替レートを算出できます。

通貨コードは大体の人が知らないので通貨コードの一覧を出力するようにしました。コードに併せて国名もつければなお親切だったかもしれません。

![通貨コードの一覧](https://github.com/user-attachments/assets/0e0659b5-ad72-4af1-8f7c-9f9cbe8a1677)

通貨コードの入出力はあまり凝っていません。最後に編集したのが電卓だったためです。入力した文字列がヒットしない場合はプログラムを終了します。

基準通貨、決済通貨、基準通貨の金額を入力すると決済通貨の金額が出力されます。

## 4.開発環境
| 項目 | 内容 |
|:---|:---|
|言語|C++17|
|エディタ|Visual Studio Code|
|コンパイラ|Mingw_w64(GCC 15.2.0)|
|ライブラリ|nlohmann/json, cpp-httplib|
|外部API|http://www.floatrates.com|

## 5.工夫した点
### バリデーション
通常の電卓と違ってキーボードで入力が行われます。そのため入力値の型を間違えた時の処理をwhile文を用いて実装しました。

```cpp
//左オペランドの入力
    do{
        cout << "左オペランド(数値)を入力してください" << endl;
        cin >> num1;
        //エラー処理
        if(cin.fail()){
            cout << "入力が数値ではありません。" << endl;
            cin.clear(); cin.ignore();
        }else break;
    }while(1);
```

### 親切なUI
グラフィックがないので、とにかく言葉を尽くしました。大学の課題や競技プログラミングではUIに凝ることがありませんでした。一つ一つの入出力に説明を出力させて、CUI特有の分かりづらさを緩和できたと思います。

## 6.今後の課題
### まだ穴の多いバリデーション
入力をループ処理することで入力ミスを回避しましたが、電卓アプリでは

```
演算子を入力してください（終了するには'q'）
+20
```

のように入力すると右オペランドを入力する前に演算の処理が終了します。原因はcinでcharを読み込む部分で複数の文字（文字列）を入力するとcinのバッファに2文字目以降のデータが残ってしまうことです。
### ファイルの分割
今回は別々にファイルを作成しましたが、ゆくゆくは各ファイルをソースファイルとして一つのプログラムに纏めたいと思います。

